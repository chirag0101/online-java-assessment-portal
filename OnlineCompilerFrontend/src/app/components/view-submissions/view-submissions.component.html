<div class="page-wrapper">
  <nav class="navbar">
    <div class="navbar-content">
      <div class="logo-section">
        <img src="images/iris_logo.png" alt="IRIS Logo" class="logo-img" />
      </div>
      <div class="portal-section">
        <span class="portal-title">{{ portalTitle }}</span>
      </div>

      <div class="user-profile-section">
        <div class="user-info">
          <span class="admin-name">{{ adminId }}</span>
          <span class="last-login"
            >Last Login: {{ lastLoggedIn | date: "medium" }}</span
          >
        </div>
        <div class="nav-separator"></div>
        <button class="nav-logout-btn" (click)="logOut()" title="Log Out">
          <i class="fa fa-power-off"></i>
        </button>
      </div>
    </div>
    <div class="navbar-underline"></div>
  </nav>

  <div class="table-container">
    <div class="table-panel">
      <div class="header-section">
        <h2><span class="title">Submissions</span></h2>

        <div class="date-range-selector">
          <label for="fromDate">From:</label>
          <input
            type="date"
            id="fromDate"
            [(ngModel)]="fromDate"
            (change)="filterSubmissionsByDate()"
            [max]="todayDate"
          />
          <label for="toDate">To:</label>
          <input
            type="date"
            id="toDate"
            [(ngModel)]="toDate"
            (change)="filterSubmissionsByDate()"
            [max]="todayDate"
          />

          <button
            *ngIf="fromDate || toDate"
            (click)="clearDateFilter()"
            style="
              background: transparent;
              border: none;
              cursor: pointer;
              color: #005aaa;
              padding: 0;
              display: flex;
              align-items: center;
            "
          >
            <mat-icon>clear</mat-icon>
          </button>
        </div>

        <div class="global-filter">
          <mat-icon style="color: #005aaa">search</mat-icon>
          <input
            type="text"
            id="globalFilter"
            [(ngModel)]="globalFilterText"
            (input)="applyGlobalFilter()"
            placeholder="Search all fields..."
          />

          <button
            *ngIf="globalFilterText"
            (click)="clearGlobalFilter()"
            style="
              background: transparent;
              border: none;
              cursor: pointer;
              color: #005aaa;
              padding: 0;
              display: flex;
              align-items: center;
            "
          >
            <mat-icon>close</mat-icon>
          </button>

          <button class="back-button" (click)="goBack()">Back</button>
        </div>
      </div>

      <div class="table-wrapper">
        <div *ngIf="loading" class="loading-message">
          Loading submissions...
        </div>
        <div *ngIf="error" class="error-message">
          Error loading submissions. Please try again.
          <button class="retry-button" (click)="fetchSubmissions()">
            <mat-icon>replay</mat-icon>
          </button>
        </div>

        <div
          *ngIf="!loading && !error && globallyFilteredSubmissions.length === 0"
          class="no-data-message"
        >
          No submissions found.
        </div>

        <table
          *ngIf="!loading && !error && globallyFilteredSubmissions.length > 0"
        >
          <thead>
            <tr>
              <th>Candidate</th>
              <th>Interviewer-ID</th>
              <th>Round</th>
              <th>Code Type</th>
              <th>Code</th>
              <th>Time</th>
              <th>Action</th>
              <th>Status</th>
              <th>Output</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let submission of globallyFilteredSubmissions">
              <td>
                {{
                  submission.candidateFullName +
                    " (" +
                    submission.candidateId +
                    ")"
                }}
              </td>
              <td>{{ submission.interviewerId }}</td>
              <td>{{submission.round}}</td>
              <td>{{ submission.codeType }}</td>
              <td>
                {{
                  submission.code.length > 50
                    ? (submission.code | slice: 0 : 50) + "..."
                    : submission.code
                }}
              </td>
              <td>{{ submission.time | date: "medium" }}</td>
              <td>{{ submission.actionPerformed }}</td>
              <td>{{ submission.status }}</td>
              <td>
                {{
                  submission.output === null
                    ? "N/A"
                    : submission.output.length > 50
                      ? (submission.output | slice: 0 : 50) + "..."
                      : submission.output
                }}
              </td>
              <td>
                <button
                  class="view-code-button"
                  (click)="viewCodeDetails(submission)"
                  style="
                    background: transparent;
                    color: #005aaa;
                    width: auto;
                    height: auto;
                  "
                  title="View Submission"
                >
                  <mat-icon>info_outline</mat-icon>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="table-footer-actions">
        <button class="back-button" (click)="goBack()">Back</button>
      </div>
    </div>
  </div>

  <footer class="login-footer">
    <div class="footer-content">
      <span class="copyright"
        >&copy; {{copyright}}</span
      >
      <span class="version-tag">{{version}}</span>
    </div>
  </footer>
</div>
